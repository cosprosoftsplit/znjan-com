---
import Page from '@/layouts/Page.astro';
import Hero from '@/components/sections/Hero.astro';
import SectionHeader from '@/components/sections/SectionHeader.astro';
import Card from '@/components/ui/Card.astro';
import Button from '@/components/ui/Button.astro';
import BeachMap from '@/components/maps/BeachMap.astro';
import InstagramGrid from '@/components/widgets/InstagramGrid.astro';
import { LANGUAGES, getLocalizedUrl, getHomeUrl, getLocalized } from '@/lib/i18n';
import type { Language } from '@/lib/i18n';
import { getTranslations } from '@/lib/translations';
import { generateHomeHreflangLinks, buildBeachSchema, buildOrganizationSchema, buildFAQSchema } from '@/lib/seo';
import { canonicalUrl } from '@/lib/utils';
import { getCollection } from 'astro:content';

export function getStaticPaths() {
  return LANGUAGES.map((lang) => ({ params: { lang } }));
}

const lang = Astro.params.lang as Language;
const translations = getTranslations(lang);
const hreflangLinks = generateHomeHreflangLinks();

const allPlaces = await getCollection('places');
const allAreas = await getCollection('beach-areas');
const allFaqs = await getCollection('faq');

const mapMarkers = [
  ...allAreas.map((area) => ({
    lat: area.data.coordinates.lat,
    lng: area.data.coordinates.lng,
    title: getLocalized(area.data.title, lang),
    category: 'beach-area',
    href: getLocalizedUrl(lang, 'beach-areas', area.data.slug[lang]),
  })),
  ...allPlaces.filter((p) => p.data.status !== 'coming-soon').map((place) => ({
    lat: place.data.coordinates.lat,
    lng: place.data.coordinates.lng,
    title: getLocalized(place.data.title, lang),
    category: place.data.category,
    href: getLocalizedUrl(lang, 'places', place.data.slug[lang]),
  })),
];

const faqs = allFaqs.sort((a, b) => a.data.order - b.data.order);
const faqSchemaItems = faqs.map((f) => ({
  question: getLocalized(f.data.question, lang),
  answer: getLocalized(f.data.answer, lang),
}));

const quickLinks = [
  {
    title: translations['nav.guides'],
    description: translations['home.readGuides'],
    href: getLocalizedUrl(lang, 'guides'),
    icon: 'üìñ',
  },
  {
    title: translations['nav.places'],
    description: translations['home.explorePlaces'],
    href: getLocalizedUrl(lang, 'places'),
    icon: 'üçΩÔ∏è',
  },
  {
    title: translations['nav.activities'],
    description: translations['home.discoverActivities'],
    href: getLocalizedUrl(lang, 'activities'),
    icon: 'üèÑ',
  },
  {
    title: translations['nav.beachAreas'],
    description: translations['home.beachAreasSubtitle'],
    href: getLocalizedUrl(lang, 'beach-areas'),
    icon: 'üèñÔ∏è',
  },
  {
    title: translations['nav.events'],
    description: translations['events.subtitle'],
    href: getLocalizedUrl(lang, 'events'),
    icon: 'üéâ',
  },
];
---

<Page
  title={translations['seo.homeTitle']}
  description={translations['seo.homeDescription']}
  lang={lang}
  translations={translations}
  canonicalUrl={canonicalUrl(`/${lang}/`)}
  hreflangLinks={hreflangLinks}
  structuredData={[buildBeachSchema(), buildOrganizationSchema(), buildFAQSchema(faqSchemaItems)]}
>
  <!-- Hero -->
  <Hero
    title={translations['home.heroTitle']}
    subtitle={translations['home.heroSubtitle']}
    ctaText={translations['home.readGuides']}
    ctaHref={getLocalizedUrl(lang, 'guides')}
    secondaryCtaText={translations['home.explorePlaces']}
    secondaryCtaHref={getLocalizedUrl(lang, 'places')}
  />

  <!-- Quick Links Grid -->
  <section class="container-page py-16">
    <SectionHeader
      title={translations['home.beachAreasTitle']}
      subtitle={translations['home.beachAreasSubtitle']}
    />

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {quickLinks.map((link) => (
        <Card href={link.href}>
          <div class="p-6">
            <div class="text-3xl mb-3">{link.icon}</div>
            <h3 class="text-lg font-semibold text-ocean-700">{link.title}</h3>
            <p class="mt-2 text-sm text-warm-500">{link.description}</p>
          </div>
        </Card>
      ))}
    </div>
  </section>

  <!-- About Znjan section -->
  <section class="bg-ocean-50 py-16">
    <div class="container-page">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-ocean-800 tracking-tight">
          {lang === 'hr' ? 'Pla≈æa ≈Ωnjan ‚Äî Miami Splita' :
           lang === 'de' ? 'Strand ≈Ωnjan ‚Äî Das Miami von Split' :
           lang === 'it' ? 'Spiaggia di ≈Ωnjan ‚Äî La Miami di Spalato' :
           'Znjan Beach ‚Äî The Miami of Split'}
        </h2>
        <p class="mt-6 text-lg text-warm-600 leading-relaxed">
          {lang === 'hr'
            ? 'Pla≈æa ≈Ωnjan je najveƒáa pla≈æa u Splitu, nedavno obnovljena investicijom od 45 milijuna eura. S novom ≈°etnicom, sportskim zonama, restoranima i amfiteatrom, ≈Ωnjan je postao jedan od najatraktivnijih jadranskih destinacija.'
            : lang === 'de'
              ? 'Der Strand ≈Ωnjan ist der gr√∂√üte Strand von Split und wurde k√ºrzlich mit einer Investition von 45 Millionen Euro umgestaltet. Mit einer neuen Promenade, Sportzonen, Restaurants und einem Amphitheater ist ≈Ωnjan zu einem der attraktivsten adriatischen Reiseziele geworden.'
              : lang === 'it'
                ? 'La spiaggia di ≈Ωnjan √® la pi√π grande di Spalato, recentemente rinnovata con un investimento di 45 milioni di euro. Con una nuova passeggiata, zone sportive, ristoranti e un anfiteatro, ≈Ωnjan √® diventata una delle destinazioni adriatiche pi√π attraenti.'
                : "Znjan Beach is Split's largest beach, recently transformed with a ‚Ç¨45M investment. With a new promenade, sports zones, restaurants, and an amphitheater, Znjan has become one of the most attractive Adriatic destinations."}
        </p>
        <div class="mt-8">
          <Button href={getLocalizedUrl(lang, 'guides')} variant="primary" size="lg">
            {translations['home.readGuides']}
          </Button>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats -->
  <section class="container-page py-16">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
      <div>
        <div class="text-3xl md:text-4xl font-bold text-ocean-600">‚Ç¨45M</div>
        <div class="mt-1 text-sm text-warm-500">
          {lang === 'hr' ? 'Investicija' : lang === 'de' ? 'Investition' : lang === 'it' ? 'Investimento' : 'Investment'}
        </div>
      </div>
      <div>
        <div class="text-3xl md:text-4xl font-bold text-ocean-600">2km+</div>
        <div class="mt-1 text-sm text-warm-500">
          {lang === 'hr' ? 'Du≈æina pla≈æe' : lang === 'de' ? 'Strandl√§nge' : lang === 'it' ? 'Lunghezza spiaggia' : 'Beach Length'}
        </div>
      </div>
      <div>
        <div class="text-3xl md:text-4xl font-bold text-ocean-600">5</div>
        <div class="mt-1 text-sm text-warm-500">
          {lang === 'hr' ? 'Zona pla≈æe' : lang === 'de' ? 'Strandzonen' : lang === 'it' ? 'Zone spiaggia' : 'Beach Zones'}
        </div>
      </div>
      <div>
        <div class="text-3xl md:text-4xl font-bold text-ocean-600">11</div>
        <div class="mt-1 text-sm text-warm-500">
          {lang === 'hr' ? 'Novih paviljonskih objekata' : lang === 'de' ? 'Neue Pavillon-Geb√§ude' : lang === 'it' ? 'Nuovi edifici padiglione' : 'New Pavilion Venues'}
        </div>
      </div>
    </div>
  </section>

  <!-- Interactive Beach Map -->
  <section class="bg-ocean-50 py-16">
    <div class="container-page">
      <SectionHeader
        title={lang === 'hr' ? 'Karta pla≈æe ≈Ωnjan' : lang === 'de' ? 'Karte Strand ≈Ωnjan' : lang === 'it' ? 'Mappa spiaggia ≈Ωnjan' : 'Znjan Beach Map'}
        subtitle={lang === 'hr' ? 'Istra≈æite pla≈æe, restorane i hotele' : lang === 'de' ? 'Erkunden Sie Str√§nde, Restaurants und Hotels' : lang === 'it' ? 'Esplora spiagge, ristoranti e hotel' : 'Explore beaches, restaurants, and hotels'}
      />
      <BeachMap lang={lang} markers={mapMarkers} zoom={15} height="450px" />
    </div>
  </section>

  <!-- Instagram Section -->
  <section class="container-page">
    <InstagramGrid
      title={lang === 'hr' ? '≈Ωnjan na Instagramu' : lang === 'de' ? '≈Ωnjan auf Instagram' : lang === 'it' ? '≈Ωnjan su Instagram' : '≈Ωnjan on Instagram'}
      subtitle={lang === 'hr' ? 'Pogledajte ≈°to vas ƒçeka na pla≈æi' : lang === 'de' ? 'Sehen Sie, was Sie am Strand erwartet' : lang === 'it' ? 'Scoprite cosa vi aspetta in spiaggia' : 'See what awaits you at the beach'}
      posts={[
        { url: 'https://www.instagram.com/p/DTfQp62jfeZ/', caption: 'Taboo Beach Club' },
        { url: 'https://www.instagram.com/p/DOPWLF-DM1e/', caption: 'Mistral Beach Club' },
        { url: 'https://www.instagram.com/p/DMyFWihzOYX/', caption: 'Mistral Beach Club' },
        { url: 'https://www.instagram.com/p/DMPgA2NMzJR/', caption: 'Mistral Beach Club' },
      ]}
      columns={2}
    />
  </section>

  <!-- FAQ Section -->
  <section class="container-page py-16">
    <SectionHeader
      title={translations['home.thingsToKnow']}
      subtitle={lang === 'hr' ? 'Odgovori na najƒçe≈°ƒáa pitanja o pla≈æi ≈Ωnjan' : lang === 'de' ? 'Antworten auf h√§ufige Fragen zum Strand ≈Ωnjan' : lang === 'it' ? 'Risposte alle domande pi√π frequenti sulla spiaggia di ≈Ωnjan' : 'Answers to common questions about Znjan Beach'}
    />
    <div class="max-w-3xl mx-auto space-y-4">
      {faqs.map((faq) => (
        <details class="group bg-white rounded-lg border border-warm-200 shadow-sm">
          <summary class="flex items-center justify-between px-6 py-4 cursor-pointer text-ocean-700 font-medium hover:text-ocean-600 transition-colors">
            <span>{getLocalized(faq.data.question, lang)}</span>
            <svg class="w-5 h-5 shrink-0 ml-4 transition-transform group-open:rotate-180 text-warm-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </summary>
          <div class="px-6 pb-4 text-warm-600 text-sm leading-relaxed">
            {getLocalized(faq.data.answer, lang)}
          </div>
        </details>
      ))}
    </div>
  </section>
</Page>
