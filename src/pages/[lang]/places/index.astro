---
import Page from '@/layouts/Page.astro';
import Hero from '@/components/sections/Hero.astro';
import Card from '@/components/ui/Card.astro';
import Badge from '@/components/ui/Badge.astro';
import { LANGUAGES, getLocalizedUrl, getLocalized } from '@/lib/i18n';
import type { Language } from '@/lib/i18n';
import { getTranslations } from '@/lib/translations';
import { generateHubHreflangLinks } from '@/lib/seo';
import { canonicalUrl } from '@/lib/utils';
import { getCollection } from 'astro:content';

export function getStaticPaths() {
  return LANGUAGES.map((lang) => ({ params: { lang } }));
}

const lang = Astro.params.lang as Language;
const translations = getTranslations(lang);
const hreflangLinks = generateHubHreflangLinks('places');

const allPlaces = await getCollection('places');
const places = allPlaces.sort((a, b) => {
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;
  return a.data.order - b.data.order;
});

const categoryIcons: Record<string, string> = {
  restaurant: 'ğŸ½ï¸',
  bar: 'ğŸ¹',
  'beach-club': 'ğŸ–ï¸',
  cafe: 'â˜•',
  shop: 'ğŸ›ï¸',
  hotel: 'ğŸ¨',
  other: 'ğŸ“',
};

const categoryLabels: Record<string, Record<Language, string>> = {
  restaurant: { en: 'Restaurant', hr: 'Restoran', de: 'Restaurant', it: 'Ristorante' },
  bar: { en: 'Bar', hr: 'Bar', de: 'Bar', it: 'Bar' },
  'beach-club': { en: 'Beach Club', hr: 'Beach Club', de: 'Beach Club', it: 'Beach Club' },
  cafe: { en: 'CafÃ©', hr: 'KafiÄ‡', de: 'CafÃ©', it: 'CaffÃ¨' },
  shop: { en: 'Shop', hr: 'Trgovina', de: 'GeschÃ¤ft', it: 'Negozio' },
  hotel: { en: 'Hotel', hr: 'Hotel', de: 'Hotel', it: 'Hotel' },
  other: { en: 'Other', hr: 'Ostalo', de: 'Sonstiges', it: 'Altro' },
};
---

<Page
  title={translations['places.title']}
  description={translations['places.subtitle']}
  lang={lang}
  translations={translations}
  canonicalUrl={canonicalUrl(getLocalizedUrl(lang, 'places'))}
  hreflangLinks={hreflangLinks}
>
  <Hero
    title={translations['places.title']}
    subtitle={translations['places.subtitle']}
  />

  <section class="container-page py-16">
    {places.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {places.map((place) => (
          <Card href={getLocalizedUrl(lang, 'places', place.data.slug[lang])}>
            <div class="p-6">
              <div class="flex items-center gap-2 mb-3">
                <span class="text-xl">{categoryIcons[place.data.category] || 'ğŸ“'}</span>
                <Badge variant="sand">{categoryLabels[place.data.category]?.[lang] || place.data.category}</Badge>
                {place.data.featured && <Badge variant="ocean">{translations['places.featured']}</Badge>}
                {place.data.priceRange && <span class="text-sm text-warm-400 ml-auto">{place.data.priceRange}</span>}
              </div>
              <h2 class="text-lg font-semibold text-ocean-700">
                {getLocalized(place.data.title, lang)}
              </h2>
              <p class="mt-2 text-sm text-warm-500 line-clamp-3">
                {getLocalized(place.data.description, lang)}
              </p>
            </div>
          </Card>
        ))}
      </div>
    ) : (
      <div class="text-center py-16">
        <p class="text-lg text-warm-500">
          {lang === 'hr' ? 'Mjesta dolaze uskoro!' :
           lang === 'de' ? 'Orte kommen bald!' :
           lang === 'it' ? 'I luoghi arriveranno presto!' :
           'Places coming soon!'}
        </p>
      </div>
    )}
  </section>
</Page>
