---
import Page from '@/layouts/Page.astro';
import Hero from '@/components/sections/Hero.astro';
import Card from '@/components/ui/Card.astro';
import Badge from '@/components/ui/Badge.astro';
import { LANGUAGES, getLocalizedUrl } from '@/lib/i18n';
import type { Language } from '@/lib/i18n';
import { getTranslations } from '@/lib/translations';
import { generateHubHreflangLinks } from '@/lib/seo';
import { canonicalUrl, formatDate } from '@/lib/utils';
import { getCollection } from 'astro:content';

export function getStaticPaths() {
  return LANGUAGES.map((lang) => ({ params: { lang } }));
}

const lang = Astro.params.lang as Language;
const translations = getTranslations(lang);
const hreflangLinks = generateHubHreflangLinks('guides');

const allGuides = await getCollection('guides', ({ data }) => data.lang === lang);
const guides = allGuides.sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime());
---

<Page
  title={translations['guides.title']}
  description={translations['guides.subtitle']}
  lang={lang}
  translations={translations}
  canonicalUrl={canonicalUrl(`/${lang}/${translations['nav.guides'] === 'Vodiči' ? 'vodici' : lang === 'de' ? 'reisefuehrer' : lang === 'it' ? 'guide' : 'guides'}/`)}
  hreflangLinks={hreflangLinks}
>
  <Hero
    title={translations['guides.title']}
    subtitle={translations['guides.subtitle']}
  />

  <section class="container-page py-16">
    {guides.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {guides.map((guide) => (
          <Card href={getLocalizedUrl(lang, 'guides', guide.data.slug[lang])}>
            <div class="p-6">
              {guide.data.cluster && (
                <Badge variant="ocean">{guide.data.cluster}</Badge>
              )}
              <h2 class="mt-3 text-lg font-semibold text-ocean-700 line-clamp-2">
                {guide.data.title[lang]}
              </h2>
              <p class="mt-2 text-sm text-warm-500 line-clamp-3">
                {guide.data.description[lang]}
              </p>
              <div class="mt-4 flex items-center gap-3 text-xs text-warm-400">
                <span>{formatDate(guide.data.publishedAt, lang)}</span>
                {guide.data.readingTime && (
                  <span>{guide.data.readingTime} {translations['guides.minuteRead']}</span>
                )}
              </div>
            </div>
          </Card>
        ))}
      </div>
    ) : (
      <div class="text-center py-16">
        <p class="text-lg text-warm-500">
          {lang === 'hr' ? 'Vodiči dolaze uskoro! Vraćajte se po najnovije informacije o plaži Žnjan.' :
           lang === 'de' ? 'Reiseführer kommen bald! Schauen Sie zurück für die neuesten Informationen über den Strand Žnjan.' :
           lang === 'it' ? 'Le guide arriveranno presto! Torna per le ultime informazioni sulla spiaggia di Žnjan.' :
           'Guides coming soon! Check back for the latest information about Znjan Beach.'}
        </p>
      </div>
    )}
  </section>
</Page>
