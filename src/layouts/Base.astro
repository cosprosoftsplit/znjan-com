---
import '@/styles/global.css';
import type { Language } from '@/lib/i18n';
import { DEFAULT_LANGUAGE, LANGUAGE_NAMES } from '@/lib/i18n';
import type { HreflangLink } from '@/lib/seo';

interface Props {
  title: string;
  description: string;
  lang?: Language;
  canonicalUrl?: string;
  ogImage?: string;
  ogType?: string;
  hreflangLinks?: HreflangLink[];
  structuredData?: Record<string, unknown> | Record<string, unknown>[];
  noIndex?: boolean;
}

const {
  title,
  description,
  lang = DEFAULT_LANGUAGE,
  canonicalUrl,
  ogImage = '/images/og-default.svg',
  ogType = 'website',
  hreflangLinks = [],
  structuredData,
  noIndex = false,
} = Astro.props;

const fullTitle = title.includes('Znjan') ? title : `${title} | Znjan.com`;
const structuredDataArray = Array.isArray(structuredData)
  ? structuredData
  : structuredData
    ? [structuredData]
    : [];

// Full OG image URL
const ogImageUrl = ogImage.startsWith('http') ? ogImage : `https://znjan.com${ogImage}`;

// Full locale codes for OG
const ogLocaleMap: Record<string, string> = {
  en: 'en_GB',
  hr: 'hr_HR',
  de: 'de_DE',
  it: 'it_IT',
};
const ogLocale = ogLocaleMap[lang] || 'en_GB';
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <!-- Primary Meta -->
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    {noIndex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Canonical -->
    {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}

    <!-- Hreflang -->
    {hreflangLinks.map((link) => (
      <link rel="alternate" hreflang={link.lang} href={link.href} />
    ))}

    <!-- Open Graph -->
    <meta property="og:type" content={ogType} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:site_name" content="Znjan.com" />
    {canonicalUrl && <meta property="og:url" content={canonicalUrl} />}
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:locale" content={ogLocale} />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageUrl} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Structured Data -->
    {structuredDataArray.map((data) => (
      <script type="application/ld+json" set:html={JSON.stringify(data)} />
    ))}
  </head>

  <body class="min-h-screen bg-cream text-stone font-sans">
    <slot />
    <script>
      // Global Intersection Observer for scroll-reveal animations
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('sr-visible');
              if (entry.target.getAttribute('data-sr-once') !== 'false') {
                observer.unobserve(entry.target);
              }
            }
          });
        },
        { threshold: 0.15, rootMargin: '0px 0px -40px 0px' }
      );
      document.querySelectorAll('.scroll-reveal').forEach((el) => observer.observe(el));
    </script>
  </body>
</html>
