---
import Base from './Base.astro';
import Header from '@/components/layout/Header.astro';
import Footer from '@/components/layout/Footer.astro';
import type { Language } from '@/lib/i18n';
import type { HreflangLink } from '@/lib/seo';
import { getLocalizedUrl } from '@/lib/i18n';

interface Props {
  title: string;
  description: string;
  lang: Language;
  translations: Record<string, string>;
  canonicalUrl?: string;
  ogImage?: string;
  hreflangLinks?: HreflangLink[];
  structuredData?: Record<string, unknown> | Record<string, unknown>[];
  category?: string;
  address?: string;
  phone?: string;
  website?: string;
  priceRange?: string;
  hours?: Record<string, string>;
}

const {
  title,
  description,
  lang,
  translations,
  canonicalUrl,
  ogImage,
  hreflangLinks,
  structuredData,
  category,
  address,
  phone,
  website,
  priceRange,
  hours,
} = Astro.props;

const categoryLabels: Record<string, Record<Language, string>> = {
  restaurant: { en: 'Restaurant', hr: 'Restoran', de: 'Restaurant', it: 'Ristorante' },
  bar: { en: 'Bar', hr: 'Bar', de: 'Bar', it: 'Bar' },
  'beach-club': { en: 'Beach Club', hr: 'Beach Club', de: 'Beach Club', it: 'Beach Club' },
  cafe: { en: 'Café', hr: 'Kafić', de: 'Café', it: 'Caffè' },
  shop: { en: 'Shop', hr: 'Trgovina', de: 'Geschäft', it: 'Negozio' },
  hotel: { en: 'Hotel', hr: 'Hotel', de: 'Hotel', it: 'Hotel' },
  other: { en: 'Other', hr: 'Ostalo', de: 'Sonstiges', it: 'Altro' },
};
---

<Base
  title={title}
  description={description}
  lang={lang}
  canonicalUrl={canonicalUrl}
  ogImage={ogImage}
  hreflangLinks={hreflangLinks}
  structuredData={structuredData}
>
  <Header lang={lang} translations={translations} />

  <main>
    <!-- Breadcrumb -->
    <nav class="container-page pt-6" aria-label="Breadcrumb">
      <ol class="flex items-center gap-2 text-sm text-stone">
        <li>
          <a href={`/${lang}/`} class="hover:text-adriatic-400 transition-colors duration-200">
            {translations['nav.home']}
          </a>
        </li>
        <li class="flex items-center gap-2">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          <a href={getLocalizedUrl(lang, 'places')} class="hover:text-adriatic-400 transition-colors duration-200">
            {translations['nav.places']}
          </a>
        </li>
        <li class="flex items-center gap-2">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          <span class="text-warm-700 font-medium">{title}</span>
        </li>
      </ol>
    </nav>

    <!-- Place Header -->
    <header class="container-page pt-8 pb-6">
      <div class="max-w-4xl">
        {category && categoryLabels[category] && (
          <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-sand-100 text-sand-800 mb-4">
            {categoryLabels[category][lang]}
          </span>
        )}
        <h1 class="text-3xl md:text-4xl font-display font-semibold text-ocean-800 tracking-tight">
          {title}
        </h1>
        <p class="mt-4 text-lg text-stone leading-relaxed">
          {description}
        </p>
      </div>
    </header>

    <!-- Place Content Grid -->
    <div class="container-page pb-16">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-5xl">
        <!-- Main Content -->
        <div class="lg:col-span-2">
          <slot />
        </div>

        <!-- Sidebar -->
        <aside class="space-y-6">
          <!-- Info Card -->
          <div class="bg-sand-50 rounded-xl border border-sand-200 p-6">
            <h2 class="font-semibold text-ocean-700 mb-4">
              {lang === 'hr' ? 'Informacije' : lang === 'de' ? 'Informationen' : lang === 'it' ? 'Informazioni' : 'Information'}
            </h2>

            <dl class="space-y-3 text-sm">
              {address && (
                <div>
                  <dt class="text-stone/70 font-medium">{translations['places.directions'] || 'Address'}</dt>
                  <dd class="mt-0.5 text-warm-700">{address}</dd>
                </div>
              )}
              {phone && (
                <div>
                  <dt class="text-stone/70 font-medium">{translations['places.phone'] || 'Phone'}</dt>
                  <dd class="mt-0.5">
                    <a href={`tel:${phone}`} class="text-adriatic-400 hover:text-adriatic-500 hover:underline">{phone}</a>
                  </dd>
                </div>
              )}
              {website && (
                <div>
                  <dt class="text-stone/70 font-medium">{translations['places.website'] || 'Website'}</dt>
                  <dd class="mt-0.5">
                    <a href={website} target="_blank" rel="noopener" class="text-adriatic-400 hover:text-adriatic-500 hover:underline">
                      {new URL(website).hostname}
                    </a>
                  </dd>
                </div>
              )}
              {priceRange && (
                <div>
                  <dt class="text-stone/70 font-medium">
                    {lang === 'hr' ? 'Raspon cijena' : lang === 'de' ? 'Preisspanne' : lang === 'it' ? 'Fascia di prezzo' : 'Price Range'}
                  </dt>
                  <dd class="mt-0.5 text-warm-700 font-medium">{priceRange}</dd>
                </div>
              )}
            </dl>

            {hours && Object.keys(hours).length > 0 && (
              <div class="mt-6 pt-4 border-t border-sand-200">
                <h3 class="text-stone/70 font-medium text-sm mb-2">{translations['places.hours'] || 'Hours'}</h3>
                <dl class="space-y-1 text-sm">
                  {Object.entries(hours).map(([day, time]) => (
                    <div class="flex justify-between">
                      <dt class="text-stone">{day}</dt>
                      <dd class="text-warm-700">{time}</dd>
                    </div>
                  ))}
                </dl>
              </div>
            )}
          </div>
        </aside>
      </div>
    </div>
  </main>

  <Footer lang={lang} translations={translations} />
</Base>
